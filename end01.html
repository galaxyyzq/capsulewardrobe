<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./css/base.min.css">
    <script src="./jquery-1.8.3.min.js"></script>
</head>

<body class="end01">
    <div class="conleft">
        <div class="conbox">
            <p class="title">Unused Tops / Dresses</p>
            <div class="png fn-clear conpng1">
                <div class="fl" id="png1">
                    <a href="javascript:;" class="png1">
                        <img name="png1" src="./images/png1.png" alt="">
                    </a>
                </div>
                <div class="fl" id="png2"> <a href="javascript:;" class="png2">
                        <img name="png2" src="./images/png2.png" alt="">
                    </a></div>
                <div class="fl" id="png3"> <a href="javascript:;" class="png3">
                        <img name="png3" src="./images/png3.png" alt="">
                    </a></div>
                <div class="fl" id="png4"> <a href="javascript:;" class="png4">
                        <img name="png4" src="./images/png4.png" alt="">
                    </a></div>
                <div class="fl" id="png5">
                    <a href="javascript:;" class="png5">
                        <img name="png5" src="./images/png5.png" alt="">
                    </a>
                </div>
                <div class="fl" id="png6"> <a href="javascript:;" class="png6">
                        <img name="png6" src="./images/png6.png" alt="">
                    </a></div>
                <div class="fl" id="png7"> <a href="javascript:;" class="png7">
                        <img name="png7" src="./images/png7.png" alt="">
                    </a></div>
                <div class="fl" id="png8"> <a href="javascript:;" class="png8">
                        <img name="png8" src="./images/png8.png" alt="">
                    </a></div>
                <div class="fl" id="png9">
                    <a href="javascript:;" class="png9">
                        <img name="png9" src="./images/png9.png" alt="">
                    </a>
                </div>
                <div class="fl" id="png10"> <a href="javascript:;" class="png10">
                        <img name="png10" src="./images/png10.png" alt="">
                    </a></div>
                <div class="fl" id="png11"> <a href="javascript:;" class="png11">
                        <img name="png11" src="./images/png11.png" alt="">
                    </a></div>
                <div class="fl" id="png12"> <a href="javascript:;" class="png12">
                        <img name="png12" src="./images/png12.png" alt="">
                    </a></div>
            </div>
            <p class="title">Unused Bottoms</p>
            <div class="png fn-clear conpng2">
                <div class="fl" id="png13">
                    <a href="javascript:;" class="png13">
                        <img name="png13" src="./images/png13.png" alt="">
                    </a>
                </div>
                <div class="fl" id="png14">
                    <a href="javascript:;" class="png14">
                        <img name="png14" src="./images/png14.png" alt="">
                    </a>
                </div>
                <div class="fl" id="png15">
                    <a href="javascript:;" class="png15">
                        <img name="png15" src="./images/png15.png" alt="">
                    </a>
                </div>
                <div class="fl" id="png16">
                    <a href="javascript:;" class="png16">
                        <img name="png16" src="./images/png16.png" alt="">
                    </a>
                </div>
                <div class="fl" id="png17">
                    <a href="javascript:;" class="png17">
                        <img name="png17" src="./images/png17.png" alt="">
                    </a>
                </div>
                <div class="fl" id="png18">
                    <a href="javascript:;" class="png18">
                        <img name="png18" src="./images/png18.png" alt="">
                    </a>
                </div>
                <div class="fl" id="png19">
                    <a href="javascript:;" class="png19">
                        <img name="png19" src="./images/png19.png" alt="">
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div class="conright">
        <p class ="descrip">Suppose you successfully used the capsule wardrobe for several weeks, there are some remaining clothes that you are not using. Minnie recommend you to deal with your rest clothes in a sustainable way. So please make your decisions here!</p>
        <div class="conbox">
          <p class="tit">Send it to relatives as gift.</p>
          <p id = "gift" ></p>
              <div class="fl" id="box0">
                  <a id="box0" href="javascript:;">
                     <!--<img name="box0" src="./images/box2.png" alt="drop">-->
                  </a>
              </div>
          <p class="tit"> Donate to non-profit orgnization like Goodwill.</p>
          <p id = "donate" ></p>
               <div class="fl" id="box1">
                  <a id="box1" href="javascript:;">
                     <!--<img name="box1" src="./images/box21.png" alt="drop">-->
                  </a>
               </div>
         <p class="tit">Sell it to local second-hand clothes center, like plato.</p>
         <p id = "trade1" ></p>
              <div class="fl" id="box2">
                  <a id="box2" href="javascript:;">
                    <!--<img name="box2" src="./images/box22.png" alt="drop">-->
                  </a>
              </div>
          <p class="tit">Sell it to online second-hand items trading platform, like Mercari.</p>
          <p id = "trade2" ></p>
              <div class="fl" id="box3">
                  <a id="box3" href="javascript:;">
                    <!--<img name="box3" src="./images/box23.png" alt="drop">-->
                  </a>
              </div>
        </div>
    <div>
        <a href="javascript:;" class="null">Okay. </a>
    </div>
    </div>
 

    <script>
        $(function () {
            var data = JSON.parse(getQueryString("data"));
            console.log(data);
            //new change
            
            var closet = getQueryString("closet");
            
            for(var i=0;i<$('.conpng1 img').length;i++){
                var url = './images/closet'+closet+'/top'+i+'.png';
                $('.conpng1 img').eq(i).attr('src',url)
                $('.conpng1 img').eq(i).attr('name','top'+i)
                $('.conpng1 img').eq(i).parent().parent().attr('id','top'+i)
                $('.conpng1 img').eq(i).parents('a').addClass('top'+i)
            }
            for(var i=0;i<$('.conpng2 img').length;i++){
                var url = './images/closet'+closet+'/bottom'+i+'.png';
                $('.conpng2 img').eq(i).attr('src',url)
                $('.conpng2 img').eq(i).attr('name','bottom'+i)
                $('.conpng2 img').eq(i).parent().parent().attr('id','bottom'+i)
                $('.conpng2 img').eq(i).parents('a').addClass('bottom'+i)
            }
            
            //new change end 
            var png = '';
            var sum = getQueryString("sum");
            console.log("Sum:",sum);
            var boxhtml = '';
            /*
            for (var i = 0; i < sum * 1; i++) {
                boxhtml += `
                            <div class="fl">
                                <a href="javascript:;"></a>
                            </div>
                `
            }
            */
            let stat = [0, 0, 0, 0];
           
            if( data ){
              if( data.length ){
                data.forEach( (current, index, arr) => {
                  let querystring = '#' + current;
                  $(querystring).remove();
                });
              }
            }

            $('p').fadeIn();
            $('.page3 li').on('click', function (e) {
                var index = $(this).index();
                console.log(index)
                $('.page3 li').removeClass('show')
                $('.page3 li:lt(' + (index + 1) + ')').addClass('show')
                $('.null i').text((index + 1))
            })

            function getQueryString(name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return unescape(r[2]);
                return null;
            }
            /* ============== */
            //start drag: access id and put it in dataTransfer
            $(".conleft .conbox .png img").on("dragstart", function (e) {
                console.log(e.target)
                console.log($(this).attr('name'))
                png = $(this).attr('name')
                // e.originalEvent.dataTransfer.setData("obj_add", e.target.id);
            });

            //allow put
            $(".conright .conbox .fl").on("dragover", function (e) {
                console.log("allowputï¼š" + e.target)
                e.originalEvent.preventDefault();
            })


            //put down
            $(".conright .conbox ").on("drop", '.fl', function (e, f) {
                console.log(e.target);
                console.log(png);
                let tgtdiv = e.target.parent;
                e.originalEvent.preventDefault;
                // var id = e.originalEvent.dataTransfer.getData("obj_add");
                // $(this).append($("#" + id));
                // e.srcElement.parent().parent().remove();
                $('#'+png).remove();
                
                /*
                if (!$(this).hasClass('stop')) {
                    console.log(e.target)
                    e.originalEvent.preventDefault;
                    // var id = e.originalEvent.dataTransfer.getData("obj_add");
                    // $(this).append($("#" + id));
                    var thispng = png;
                    $(this).find('a').append($('.' + thispng).find('img'));
                    $(this).addClass('stop');
                }
                */
                
                $("a#"+e.target.id).append("<div class=\"flin\" id="+ e.target.id + png + "\">\n"
                  + "<img src="+ './images/closet'+closet + "/" + png +'.png' +"></img>\n" 
                  + "</div>");
                
                if( e.target.id == "box0" ){
                  stat[0] ++;
                  $('#gift').text(stat[0]);
                }
                
                if( e.target.id == "box1" ){
                  stat[1] ++;
                  $('#donate').text(stat[1]);
                }
                
                if( e.target.id == "box2"){
                  stat[2] ++;
                  $('#trade1').text(stat[2]);
                }
                if( e.target.id == "box3"){
                  stat[3] ++;
                  $('#trade2').text(stat[2]);
                }
            })
            
            /* restart */
            /*
            $('.conright .conbox').on('click', 'img', function () {
                var name = $(this).attr('name');
                var aimpng = $(this);
                console.log(name)
                console.log(aimpng)
                $(this).parents('.fl').removeClass('stop');
                $('.conleft').find('.' + name).append(aimpng)

            })
            */
            
            $('.null').on('click', function () {
                var length = $('.conright .conbox').find('img').length;
                var aim = data;
                console.log(aim)
                window.location.href = './end02.html?sum=' + getQueryString("sum") + '&data=' + JSON
                    .stringify(aim) + '&sell=' + JSON.stringify(stat);
            })
        })
    </script>
</body>

</html>