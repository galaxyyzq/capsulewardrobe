<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./css/base.min.css">
    <script src="./jquery-1.8.3.min.js"></script>
</head>

<body class="page4">
    <div class="conleft">
        <p class="tit">The original wardrobe (spring)</p>
        <div class="conbox">
            <p class="title">Tops and dresses</p>
            <div class="png fn-clear conpng1">
                <div class="fl">
                    <a href="javascript:;" class="png1">
                        <img name="png1" src="./images/png1.png" alt="">
                    </a>
                </div>
                <div class="fl"> <a href="javascript:;" class="png2">
                        <img name="png2" src="./images/png2.png" alt="">
                    </a></div>
                <div class="fl"> <a href="javascript:;" class="png3">
                        <img name="png3" src="./images/png3.png" alt="">
                    </a></div>
                <div class="fl"> <a href="javascript:;" class="png4">
                        <img name="png4" src="./images/png4.png" alt="">
                    </a></div>
                <div class="fl">
                    <a href="javascript:;" class="png5">
                        <img name="png5" src="./images/png5.png" alt="">
                    </a>
                </div>
                <div class="fl"> <a href="javascript:;" class="png6">
                        <img name="png6" src="./images/png6.png" alt="">
                    </a></div>
                <div class="fl"> <a href="javascript:;" class="png7">
                        <img name="png7" src="./images/png7.png" alt="">
                    </a></div>
                <div class="fl"> <a href="javascript:;" class="png8">
                        <img name="png8" src="./images/png8.png" alt="">
                    </a>
                </div>
                <div class="fl">
                    <a href="javascript:;" class="png9">
                        <img name="png9" src="./images/png9.png" alt="">
                    </a>
                </div>
                <div class="fl"> <a href="javascript:;" class="png10">
                        <img name="png10" src="./images/png10.png" alt="">
                    </a></div>
                <div class="fl"> <a href="javascript:;" class="png11">
                        <img name="png11" src="./images/png11.png" alt="">
                    </a></div>
                <div class="fl"> <a href="javascript:;" class="png12">
                        <img name="png12" src="./images/png12.png" alt="">
                    </a></div>
            </div>
            <p class="title">Bottoms</p>
            <div class="png fn-clear conpng2">
                <div class="fl">
                    <a href="javascript:;" class="png13">
                        <img name="png13" src="./images/png3.png" alt="">
                    </a>
                </div>
                <div class="fl">
                    <a href="javascript:;" class="png14">
                        <img name="png14" src="./images/png14.png" alt="">
                    </a>
                </div>
                <div class="fl">
                    <a href="javascript:;" class="png15">
                        <img name="png15" src="./images/png15.png" alt="">
                    </a>
                </div>
                <div class="fl">
                    <a href="javascript:;" class="png16">
                        <img name="png16" src="./images/png16.png" alt="">
                    </a>
                </div>
                <div class="fl">
                    <a href="javascript:;" class="png17">
                        <img name="png17" src="./images/png17.png" alt="">
                    </a>
                </div>
                <div class="fl">
                    <a href="javascript:;" class="png18">
                        <img name="png18" src="./images/png18.png" alt="">
                    </a>
                </div>
                <div class="fl">
                    <a href="javascript:;" class="png19">
                        <img name="png19" src="./images/png19.png" alt="">
                    </a>
                </div>
                 <div class="fl">
                    <a href="javascript:;" class="png19">
                        <img name="png19" src="./images/png20.png" alt="">
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div class="conright">
        <p class="tit">Minimalist wardrobe (spring)</p>
        <div class="conbox">
        </div>
        <a href="javascript:;" class="null">Okay. </a>
    </div>

    <script>
        $(function () {
            //new change
            for(var i=0;i<$('.conpng1 img').length;i++){
                var closet = getQueryString("closet");
                var url = './images/closet'+closet+'/top'+i+'.png';
                $('.conpng1 img').eq(i).attr('src',url)
                $('.conpng1 img').eq(i).attr('name','top'+i)
                $('.conpng1 img').eq(i).parents('a').addClass('top'+i)
            }
            for(var i=0;i<$('.conpng2 img').length;i++){
                var closet = getQueryString("closet");
                var url = './images/closet'+closet+'/bottom'+i+'.png';
                $('.conpng2 img').eq(i).attr('src',url)
                $('.conpng2 img').eq(i).attr('name','bottom'+i)
                $('.conpng2 img').eq(i).parents('a').addClass('bottom'+i)
            }
            //new change end 
            var png = '';
            var sum = getQueryString("sum");
            console.log(sum)
            var boxhtml = '';
            for (var i = 0; i < sum * 1; i++) {
                boxhtml += `
                            <div class="fl">
                                <a href="javascript:;"></a>
                            </div>
                `
            }
            $('.conright .conbox').html(boxhtml)
            $('p').fadeIn();
            $('.page3 li').on('click', function (e) {
                var index = $(this).index();
                console.log(index)
                $('.page3 li').removeClass('show')
                $('.page3 li:lt(' + (index + 1) + ')').addClass('show')
                $('.null i').text((index + 1))
            })

            function getQueryString(name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return unescape(r[2]);
                return null;
            }

            //start drag: access id and put it in dataTransfer //new change
            $(".conleft .conbox .png ").on("dragstart",'img',function (e) {
                console.log(e.target)
                console.log($(this).attr('name'))
                png = $(this).attr('name')
                // e.originalEvent.dataTransfer.setData("obj_add", e.target.id);
            });

            //allow put
            $(".conright .conbox .fl").on("dragover", function (e) {
                console.log("allowputï¼š" + e.target)
                e.originalEvent.preventDefault();
            })


            //put down
            $(".conright .conbox ").on("drop", '.fl', function (e) {
                if (!$(this).hasClass('stop')) {
                    console.log(e.target)
                    e.originalEvent.preventDefault;
                    // var id = e.originalEvent.dataTransfer.getData("obj_add");
                    // $(this).append($("#" + id));
                    var thispng = png;
                    $(this).find('a').append($('.' + thispng).find('img'));
                    $(this).addClass('stop');
                }
            })
            /* restart */
            $('.conright .conbox').on('click', 'img', function () {
                var name = $(this).attr('name');
                var aimpng = $(this);
                console.log(name)
                console.log(aimpng)
                $(this).parents('.fl').removeClass('stop');
                $('.conleft').find('.' + name).append(aimpng)

            })
            $('.null').on('click', function () {
                var length = $('.conright .conbox').find('img').length;
                var aim = [];
                for (var i = 0; i < length; i++) {
                    console.log($('.conright .conbox').find('img').eq(i).attr('name'))
                    aim.push($('.conright .conbox').find('img').eq(i).attr('name'))
                }
                console.log(aim)
                //new change
                window.location.href = './page5.html?sum=' + getQueryString("sum") + '&data=' + JSON
                    .stringify(aim)+'&closet='+getQueryString("closet")
            })
        })
    </script>
</body>

</html>